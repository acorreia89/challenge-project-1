{
  "annotations": {
    "list": []
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "type": "stat",
      "title": "Taxa de Requisições (req/s)",
      "targets": [
        {
          "expr": "rate(http_server_requests_seconds_count{service_name=\"$service\"}[1m])",
          "refId": "A",
          "datasource": {
            "type": "prometheus",
            "uid": "PROM_DS"
          }
        }
      ],
      "gridPos": { "x": 0, "y": 0, "w": 6, "h": 4 }
    },
    {
      "type": "stat",
      "title": "Latência Média (ms)",
      "targets": [
        {
          "expr": "rate(http_server_requests_seconds_sum{service_name=\"$service\"}[1m]) / rate(http_server_requests_seconds_count{service_name=\"$service\"}[1m]) * 1000",
          "refId": "A",
          "datasource": {
            "type": "prometheus",
            "uid": "PROM_DS"
          }
        }
      ],
      "gridPos": { "x": 6, "y": 0, "w": 6, "h": 4 }
    },
    {
      "type": "stat",
      "title": "Taxa de Erros (%)",
      "targets": [
        {
          "expr": "rate(http_server_requests_seconds_count{service_name=\"$service\",status=~\"5..\"}[1m]) / rate(http_server_requests_seconds_count{service_name=\"$service\"}[1m]) * 100",
          "refId": "A",
          "datasource": {
            "type": "prometheus",
            "uid": "PROM_DS"
          }
        }
      ],
      "gridPos": { "x": 12, "y": 0, "w": 6, "h": 4 }
    },
    {
      "type": "table",
      "title": "Traces Recentes",
      "pluginVersion": "9.0.0",
      "targets": [
        {
          "queryType": "traceql",
          "query": "{ service.name = \"$service\" }",
          "refId": "A",
          "datasource": {
            "type": "tempo",
            "uid": "TEMPO_DS"
          }
        }
      ],
      "gridPos": { "x": 0, "y": 4, "w": 12, "h": 10 }
    },
    {
      "type": "logs",
      "title": "Logs Correlacionados",
      "targets": [
        {
          "expr": "{service_name=\"$service\"} | trace_id=\"$trace_id\"",
          "refId": "A",
          "datasource": {
            "type": "loki",
            "uid": "LOKI_DS"
          }
        }
      ],
      "gridPos": { "x": 12, "y": 4, "w": 12, "h": 10 }
    }
  ],
  "schemaVersion": 36,
  "style": "dark",
  "tags": ["opentelemetry", "tempo", "prometheus", "loki"],
  "templating": {
    "list": [
      {
        "name": "service",
        "type": "query",
        "label": "Serviço",
        "datasource": {
          "type": "prometheus",
          "uid": "PROM_DS"
        },
        "query": "label_values(service_name)",
        "refresh": 1
      },
      {
        "name": "trace_id",
        "type": "textbox",
        "label": "Trace ID",
        "query": "",
        "refresh": 0
      }
    ]
  },
  "time": {
    "from": "now-15m",
    "to": "now"
  },
  "timezone": "",
  "title": "Challenge-1 Observabilidade",
  "version": 1
}
